# -*- coding: utf-8 -*-
"""C√≥pia de Imers√£o IA Alura + Google Gemini - Aula 05 - Agentes.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/11SQc09SzZkM8wHQd72ScXFzCxY5m1iWI
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install google-genai

# Configura a API Key do Google Gemini

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Configura o cliente da SDK do Gemini

from google import genai

client = genai.Client()

MODEL_ID = "gemini-2.0-flash"

# Pergunta ao Gemini uma informa√ß√£o mais recente que seu conhecimento

from IPython.display import HTML, Markdown

# Instalar Framework ADK de agentes do Google ################################################
!pip install -q google-adk

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types  # Para criar conte√∫dos (Content e Part)
from datetime import date
import textwrap # Para formatar melhor a sa√≠da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisi√ß√µes HTTP
import warnings

warnings.filterwarnings("ignore")

# Fun√ß√£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()
    # Cria uma nova sess√£o (voc√™ pode personalizar os IDs conforme necess√°rio)
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conte√∫do da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execu√ß√£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

# Fun√ß√£o auxiliar para exibir texto formatado em Markdown no Colab
def to_markdown(text):
  text = text.replace('‚Ä¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

##########################################
# --- Agente 1: Buscador de Not√≠cias --- #
##########################################
def agente_buscador(topico, data_de_hoje):
    buscador = Agent(
        name="agente_buscador",
        model="gemini-2.0-flash",
        description="Agente que busca informa√ß√£o geral e detalhada no google sobre um t√≥pico.",
        tools=[google_search],
        instruction="""
       Fun√ß√£o: Agente especializado em buscar e coletar dados e informa√ß√µes
       relevantes em (Google Search).
       Fornecer pesquisa detalhadas e relevantes para o planejamento e organiza√ß√£o de conte√∫do.
       Oferecer apenas as pesquisas mais relevantes.
       **Instru√ß√µes de Busca Espec√≠ficas:**
       1. **Foco Principal:** Busque por **informa√ß√µes aprofundadas, dados, fatos, tend√™ncias, contextos e detalhes** sobre o t√≥pico fornecido. O objetivo √© obter um entendimento completo e factual do assunto.
       2. **Conte√∫do a Excluir Ativamente:**
          - Cursos online, treinamentos, webinars, plataformas de ensino √† dist√¢ncia, materiais de curso.
       3. **Recomenda√ß√µes (Livros, etc.):** Se encontrar recomenda√ß√µes relevantes (como livros) que **complementam ou ilustram a informa√ß√£o geral** sobre o t√≥pico, pode inclu√≠-las. No entanto, o foco **n√£o** √© criar uma lista de recomenda√ß√µes, mas sim usar essas recomenda√ß√µes como exemplos ou fontes dentro de um contexto informativo mais amplo.

       Identificar e extrair informa√ß√µes chave, dados, tend√™ncias e exemplos **que expliquem e detalhem o t√≥pico**.
       Summarizar os achados de forma clara e concisa, priorizando a apresenta√ß√£o das **informa√ß√µes informativas e factuais** encontradas. Mencione recomenda√ß√µes apenas se forem altamente relevantes para o conte√∫do informativo.
        """
    )
    entrada_do_agente_buscador = f"T√≥pico: {topico}\nData de hoje: {data_de_hoje}"
    # Executa o agente
    resposta_do_agente_buscador = call_agent(buscador, entrada_do_agente_buscador)
    return resposta_do_agente_buscador

################################################
# --- Agente 2: Planejador de posts --- #
################################################
def agente_planejador(topico, lancamentos_buscados):
    planejador = Agent(
        name="agente_planejador",
        model="gemini-2.0-flash",
        # Inserir as instru√ß√µes do Agente Planejador #################################################
        instruction="""
        Fun√ß√£o: Agente especializado em estruturar e organizar informa√ß√µes para
        criar planos de conte√∫do detalhados e acion√°veis para a reda√ß√£o final.
        Baseado no T√≥pico e nos dados de Lan√ßamentos buscados, crie um plano
        de conte√∫do organizado em SE√á√ïES ENUMERADAS em Markdown.

        Exemplo de formato desejado:
        1. T√≠tulo da Primeira Se√ß√£o (ex: tema 1)
        2. T√≠tulo da Segunda Se√ß√£o (ex: tema 2)
        3. T√≠tulo da Terceira Se√ß√£o (ex: tema 3)
        4. Titulo da Quarta Se√ß√£o (ex: tema 4)

        Certifique-se de que cada ponto numerado √© um t√≠tulo de se√ß√£o claro e conciso.
        Filtrar os dados recebidos pelo agente_buscador selecionando apenas 4 mais relevantes e importantes
        abordar.
        N√ÉO GERAR MAIS DE 4 SE√á√ïES.
        Selecionar sita√ß√µes, pesquisas ou fatos interessantes para abordar nos paragrafos.
        O plano deve ser uma lista numerada que delineia a estrutura completa do post.
        """,
        description="Planejador de conte√∫do",
    )

    entrada_do_agente_planejador = f"T√≥pico:{topico}\nLan√ßamentos buscados: {lancamentos_buscados}"
    # Executa o agente
    plano_do_post = call_agent(planejador, entrada_do_agente_planejador)
    return plano_do_post

######################################
# --- Agente 3: Redator do Post --- #
######################################
def agente_redator(topico, plano_de_post):
    redator = Agent(
        name="agente_redator",
        model="gemini-2.0-flash",
        instruction="""
        Voc√™ √© um redator Criativo especializado em linguagem e gramatica,
        com foco em criar reda√ß√µes e resumos tecnicos profissionais.
        Voc√™ escreve para alunos e profissionais buscando aprimorar seus conhecimentos.
        Escrita profissional mas com toque did√°tico.
        Utilize o tema fornecido no plano de post e os pontos mais relevantes fornecidos e, com base nisso,
        escreva o texto abordando o tema.
        Importante ressaltar para deixar pelo menos 1 cita√ß√£o relevante.
        O post deve ser engajador, informativo, que prenda a ten√ß√£o e foco do leitor.
        O texto deve seguir um padr√£o de no m√°ximo 300 palavras.
            """,
        description="Agente redator de posts engajador"
    )
    entrada_do_agente_redator = f"T√≥pico: {topico}\nPlano de post: {plano_de_post}"
    # Executa o agente
    rascunho = call_agent(redator, entrada_do_agente_redator)
    return rascunho

##########################################
# --- Agente 4: Revisor de Qualidade --- #
##########################################
def agente_revisor(topico, rascunho_gerado):
    revisor = Agent(
        name="agente_revisor",
        model="gemini-2.0-flash",
        instruction="""
        Voc√™ √© um revisor Criativo especializado em linguagem e gramatica,
        com foco em criar reda√ß√µes e resumos tecnicos profissionais.
        Voc√™ escreve para alunos e profissionais buscando aprimorar seus conhecimentos.
        Escrita profissional mas com toque did√°tico. Seja conciso em suas reda√ß√µes.
        Revise o rascunho de post abaixo sobre o t√≥pico indicado, verificando
        sua escrita.
        N√£o desejo que seja exigente e nem fa√ßa muitas corre√ß√µes
        Apenas exija mudan√ßa se for realmente importante e necess√°rio para
        melhoria do material original.
        Se o rascunho estiver bom, responda apenas 'O rascunho est√° pronto!'.
        O texto deve seguir um padr√£o de no m√°ximo 300 palavras.
        proibido de fazer corre√ß√£o ap√≥s 2 tentativas.
        """,
        description="Agente revisor de post."
    )
    entrada_do_agente_revisor = f"T√≥pico: {topico}\nRascunho: {rascunho_gerado}"
    # Executa o agente
    texto_revisado = call_agent(revisor, entrada_do_agente_revisor)
    return texto_revisado

from datetime import date
import re
from IPython.display import display, Markdown
from google.adk.agents import Agent  # Import Agent
from google.adk.runners import Runner # Import Runner
from google.adk.sessions import InMemorySessionService # Import InMemorySessionService
from google.adk.tools import google_search # Import google_search
from google.genai import types  # Para criar conte√∫dos (Content e Part) # Import types
import textwrap

# --- Fun√ß√µes Auxiliares (mantenha ou adapte conforme necess√°rio) ---
# ... (mantenha as defini√ß√µes de extract_content_from_part, call_agent, to_markdown, extrair_secoes_do_plano)

def extract_content_from_part(part):
    """Extracts text content from a GenAI Part."""
    if part.text:
        return part.text
    return ""

def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()
    # Cria uma nova sess√£o
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conte√∫do da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    try:
        for event in runner.run(user_id="user1", session_id="session1", new_message=content):
            if event.is_final_response():
              for part in event.content.parts:
                final_response += extract_content_from_part(part)
                final_response += "\n"
    except Exception as e:
        print(f"Error during agent run: {e}")
    return final_response

def to_markdown(text):
  text = text.replace('‚Ä¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))


def extrair_secoes_do_plano(texto_plano: str) -> list[str]:
    secoes = []
    padroes_secao = [
        r'^\s*##\s*(.+)',
        r'^\s*\d+\.\s*(.+)',
        r'^\s*-\s*(.+)'
    ]
    linhas = texto_plano.splitlines()
    for linha in linhas:
        for padrao in padroes_secao:
            match = re.match(padrao, linha.strip())
            if match:
                secao_titulo = match.group(1).strip()
                if secao_titulo and len(secao_titulo) > 3:
                    secoes.append(secao_titulo)
                break
    if not secoes and texto_plano.strip():
         return ["Conte√∫do Principal"]
    elif not secoes and not texto_plano.strip():
        return []
    return secoes


# --- Agente 1: Buscador de Not√≠cias ---
# Defina o objeto do agente aqui ou antes da l√≥gica principal
buscador_agent_obj = Agent(
    name="agente_buscador",
    model="gemini-2.0-flash",
    description="Agente que busca informa√ß√£o geral e detalhada no google sobre um t√≥pico.",
    tools=[google_search],
    instruction="""
   Fun√ß√£o: Agente especializado em buscar e coletar dados e informa√ß√µes
   relevantes em (Google Search).
   Fornecer pesquisa detalhadas e relevantes para o planejamento e organiza√ß√£o de conte√∫do.
   Oferecer apenas as pesquisas mais relevantes.
   **Instru√ß√µes de Busca Espec√≠ficas:**
   1. **Foco Principal:** Busque por **informa√ß√µes aprofundadas, dados, fatos, tend√™ncias, contextos e detalhes** sobre o t√≥pico fornecido, **considerando o foco e prop√≥sito especificados pelo usu√°rio**. O objetivo √© obter um entendimento completo e factual do assunto, **alinhado com a forma de abordagem desejada**.
   2. **Conte√∫do a Excluir Ativamente:**
      - Cursos online, treinamentos, webinars, plataformas de ensino √† dist√¢ncia, materiais de curso.
   3. **Recomenda√ß√µes (Livros, etc.):** Se encontrar recomenda√ß√µes relevantes (como livros) que **complementam ou ilustram a informa√ß√£o geral** sobre o t√≥pico, pode inclu√≠-las. No entanto, o foco **n√£o** √© criar uma lista de recomenda√ß√µes, mas sim usar essas recomenda√ß√µes como exemplos ou fontes dentro de um contexto informativo mais amplo.

   Identificar e extrair informa√ß√µes chave, dados, tend√™ncias e exemplos **que expliquem e detalhem o t√≥pico**, **seguindo a forma de abordagem e o prop√≥sito definidos pelo usu√°rio**.
   Summarizar os achados de forma clara e concisa, priorizando a apresenta√ß√£o das **informa√ß√µes informativas e factuais** encontradas. Mencione recomenda√ß√µes apenas se forem altamente relevantes para o conte√∫do informativo.
    """
)

# --- Agente 2: Planejador de posts ---
# Defina o objeto do agente aqui ou antes da l√≥gica principal
planejador_agent_obj = Agent(
    name="agente_planejador",
    model="gemini-2.0-flash",
    instruction="""
    Fun√ß√£o: Agente especializado em estruturar e organizar informa√ß√µes para
    criar planos de conte√∫do detalhados e acion√°veis para a reda√ß√£o final.
    Baseado no T√≥pico, Forma de Abordagem, Prop√≥sito e nos dados de Lan√ßamentos buscados, crie um plano
    de conte√∫do organizado em SE√á√ïES ENUMERADAS em Markdown.

    Exemplo de formato desejado:
    1. T√≠tulo da Primeira Se√ß√£o (ex: tema 1)
    2. T√≠tulo da Segunda Se√ß√£o (ex: tema 2)
    3. T√≠tulo da Terceira Se√ß√£o (ex: tema 3)
    4. Titulo da Quarta Se√ß√£o (ex: tema 4)

    Certifique-se de que cada ponto numerado √© um t√≠tulo de se√ß√£o claro e conciso.
    Filtrar os dados recebidos pelo agente_buscador selecionando apenas 4 mais relevantes e importantes
    abordar, **considerando a Forma de Abordagem e o Prop√≥sito especificados**.
    N√ÉO GERAR MAIS DE 4 SE√á√ïES.
    Selecionar sita√ß√µes, pesquisas ou fatos interessantes para abordar nos paragrafos, **alinhados com a Forma de Abordagem e Prop√≥sito**.
    O plano deve ser uma lista numerada que delineia a estrutura completa do post.
    """,
    description="Planejador de conte√∫do",
)

# --- Agente 3: Redator do Post ---
# Defina o objeto do agente aqui ou antes da l√≥gica principal
redator_agent_obj = Agent(
    name="agente_redator",
    model="gemini-2.0-flash",
    instruction="""
        Voc√™ √© um redator Criativo especializado em linguagem e gramatica,
        com foco em criar reda√ß√µes e resumos tecnicos profissionais.
        Voc√™ escreve para alunos e profissionais buscando aprimorar seus conhecimentos.
        Escrita profissional mas com toque did√°tico.
        Utilize o tema fornecido no plano de post e os pontos mais relevantes fornecidos e, com base nisso,
        escreva o texto abordando o tema, **mantendo a Forma de Abordagem e o Prop√≥sito originais**.
        Importante ressaltar para deixar pelo menos 1 cita√ß√£o relevante.
        O post deve ser engajador, informativo, que prenda a ten√ß√£o e foco do leitor.
        O texto deve seguir um padr√£o de no m√°ximo 300 palavras.

        """,
    description="Agente redator de posts engajador"
)

# --- Agente 4: Revisor de Qualidade ---
# Defina o objeto do agente aqui ou antes da l√≥gica principal
revisor_agent_obj = Agent(
    name="agente_revisor",
    model="gemini-2.0-flash",
    instruction="""
        Voc√™ √© um revisor Criativo especializado em linguagem e gramatica,
        com foco em criar reda√ß√µes e resumos tecnicos profissionais.
        Voc√™ escreve para alunos e profissionais buscando aprimorar seus conhecimentos.
        Escrita profissional mas com toque did√°tico. Seja conciso em suas reda√ß√µes.
        Revise o rascunho de post abaixo sobre o t√≥pico indicado, verificando
        sua escrita, **assegurando que a Forma de Abordagem e o Prop√≥sito originais sejam mantidos**.
        N√£o desejo que seja exigente e nem fa√ßa muitas corre√ß√µes
        Apenas exija mudan√ßa se for realmente importante e necess√°rio para
        melhoria do material original.
        Se o rascunho estiver bom, responda apenas 'O rascunho est√° pronto!'.
        O texto deve seguir um padr√£o de no m√°ximo 300 palavras.
        proibido de fazer corre√ß√£o ap√≥s 2 tentativas.
        """,
    description="Agente revisor de post."
)


# --- L√≥gica Principal de Orquestra√ß√£o do Chatbot (Modificada) ---

## üöÄ Iniciando o Sistema de Planejamento e Gera√ß√£o de Conte√∫do üöÄ

# Obt√©m a data atual para uso posterior
data_de_hoje = date.today().strftime("%d/%m/%Y")

### ‚ùì Obtendo o T√≥pico e Prefer√™ncias do Usu√°rio

print("## üìö Inicie o Planejamento do seu Conte√∫do! üìö")

print("\nPor favor, digite o T√ìPICO principal sobre o qual voc√™ quer estudar/criar conte√∫do:")
topico = input("T√≥pico: ")

if not topico:
  print("‚ùå Nenhum t√≥pico inserido. Por favor, insira um t√≥pico v√°lido para continuar.")
else:
  print(f"\n‚úÖ T√≥pico recebido: {topico}.")

  print("\nCom qual FORMA DE ABORDAGEM voc√™ deseja que o tema seja tratado? (Ex: T√©cnica, Did√°tica, Hist√≥rica, Comparativa, etc.)")
  forma_abordagem = input("Forma de Abordagem: ")

  print("\nQual o PROP√ìSITO principal deste conte√∫do? (Ex: Explicar um conceito, Comparar tecnologias, Apresentar tend√™ncias, Guia pr√°tico, etc.)")
  proposito_conteudo = input("Prop√≥sito do Conte√∫do: ")

  print(f"\n‚úÖ Prefer√™ncias capturadas:")
  print(f"- T√≥pico: {topico}")
  print(f"- Forma de Abordagem: {forma_abordagem if forma_abordagem else 'N√£o especificada'}")
  print(f"- Prop√≥sito: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}")

  print("\nIniciando o processo de busca e planejamento...")

  ## üîç Etapa 1: Buscando Informa√ß√µes Relevantes (Agente Buscador)

  print("\n--- Executando Agente Buscador ---")
  # Chama o agente buscador para coletar dados sobre o t√≥pico
  # Inclua as prefer√™ncias do usu√°rio na entrada do agente buscador
  entrada_do_agente_buscador = f"""
  T√≥pico: {topico}
  Data de hoje: {data_de_hoje}
  Forma de Abordagem Desejada: {forma_abordagem if forma_abordagem else 'N√£o especificada'}
  Prop√≥sito do Conte√∫do: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}
  """
  lan√ßamentos_buscados = call_agent(buscador_agent_obj, entrada_do_agente_buscador)

  print("\n### Resultado da Busca:")
  # Exibe os resultados da busca formatados em Markdown
  display(to_markdown(lan√ßamentos_buscados))
  print("-------------------------------")

  ## üìù Etapa 2: Planejando a Estrutura do Conte√∫do (Agente Planejador)

  print("\n--- Executando Agente Planejador ---")
  # Chama o agente planejador para criar um plano de conte√∫do baseado na busca
  # Inclua as prefer√™ncias do usu√°rio na entrada do agente planejador
  entrada_do_agente_planejador = f"""
  T√≥pico: {topico}
  Forma de Abordagem Desejada: {forma_abordagem if forma_abordagem else 'N√£o especificada'}
  Prop√≥sito do Conte√∫do: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}
  Lan√ßamentos buscados: {lan√ßamentos_buscados}
  """
  plano_de_post = call_agent(planejador_agent_obj, entrada_do_agente_planejador)

  print("\n### Plano de Conte√∫do Gerado:")
  # Exibe o plano de conte√∫do formatado em Markdown
  display(to_markdown(plano_de_post))
  print("-------------------------------")

  ## ‚úçÔ∏è Etapa 3: Gerando e Revisando Conte√∫do por Se√ß√£o (Agente Redator & Revisor)

  print("\n--- Iniciando Gera√ß√£o e Revis√£o do Rascunho (por Se√ß√£o) ---")

  # Extrai as se√ß√µes do plano de conte√∫do para processamento individual
  secoes_do_plano = extrair_secoes_do_plano(plano_de_post)

  # Crie uma lista para armazenar os rascunhos de cada se√ß√£o
  rascunhos_individuais_secoes = []

  if not secoes_do_plano:
      print("‚ö†Ô∏è Aviso: N√£o foi poss√≠vel extrair se√ß√µes do plano. N√£o ser√° poss√≠vel gerar o rascunho por se√ß√£o.")
      rascunho_do_post = "" # Define rascunho_do_post como vazio se n√£o houver se√ß√µes
  else:
      rascunho_do_post_partes = [] # Lista para armazenar as partes do rascunho por se√ß√£o
      MAX_TENTATIVAS_REVISAO = 3 # Limite para o ciclo de revis√£o por se√ß√£o

      # Loop sobre cada se√ß√£o do plano
      for i, secao in enumerate(secoes_do_plano):
          print(f"\n--- Processando Se√ß√£o {i+1}/{len(secoes_do_plano)}: '{secao}' ---")

          ### ‚úèÔ∏è Gerando Rascunho Inicial da Se√ß√£o

          # Inclua as prefer√™ncias do usu√°rio na entrada para o redator
          entrada_para_redator_secao = f"""
          T√≥pico Geral: {topico}
          Forma de Abordagem Desejada: {forma_abordagem if forma_abordagem else 'N√£o especificada'}
          Prop√≥sito do Conte√∫do: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}

          Plano de Conte√∫do Completo:
          {plano_de_post}

          ---
          POR FAVOR, ESCREVA APENAS O CONTE√öDO DA SE√á√ÉO ESPEC√çFICA ABAIXO.
          N√£o inclua o t√≠tulo da se√ß√£o no in√≠cio da sua resposta.
          Se√ß√£o a escrever: {secao}

          Instru√ß√µes Adicionais para esta Se√ß√£o:
          (Se houver instru√ß√µes espec√≠ficas para esta se√ß√£o do plano, adicione aqui)
          """
          rascunho_da_secao = call_agent(redator_agent_obj, entrada_para_redator_secao)
          print("\n#### Rascunho Inicial:")
          display(to_markdown(rascunho_da_secao))
          print("-------------------------------")

          ### üëÄ Ciclo de Revis√£o da Se√ß√£o

          revisao_finalizada = False
          tentativas_revisao = 0

          # Loop de revis√£o at√© aprova√ß√£o ou limite de tentativas
          while not revisao_finalizada and tentativas_revisao < MAX_TENTATIVAS_REVISAO:
              tentativas_revisao += 1
              print(f"\n--- Revisando Se√ß√£o (Tentativa {tentativas_revisao}/{MAX_TENTATIVAS_REVISAO}) ---")

              # Inclua as prefer√™ncias do usu√°rio na entrada para o revisor
              entrada_para_revisor_secao = f"""
              T√≥pico Geral: {topico}
              Forma de Abordagem Desejada: {forma_abordagem if forma_abordagem else 'N√£o especificada'}
              Prop√≥sito do Conte√∫do: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}
              Plano de Conte√∫do Relevante para esta Se√ß√£o: {plano_de_post}

              ---
              Rascunho da Se√ß√£o "{secao}" para Revis√£o:
              {rascunho_da_secao}

              Por favor, revise o rascunho da se√ß√£o acima. Se estiver bom, responda APENAS a frase exata 'O rascunho est√° √≥timo e pronto!'. Caso contr√°rio, aponte os problemas e sugira melhorias espec√≠ficas para que o redator possa corrigir. Certifique-se de que a revis√£o leva em conta a Forma de Abordagem e o Prop√≥sito originais.
              """

              feedback_revisor = call_agent(revisor_agent_obj, entrada_para_revisor_secao)
              print("\n#### Feedback do Revisor:")
              display(to_markdown(feedback_revisor))
              print("-------------------------------")

              if feedback_revisor.strip().lower() == 'o rascunho est√° √≥timo e pronto!':
                  print(f"üëç Se√ß√£o '{secao}' aprovada pelo Revisor!")
                  revisao_finalizada = True # Sai do loop de revis√£o para esta se√ß√£o
              else:
                  print(f"üîÑ Se√ß√£o '{secao}' precisa de corre√ß√µes. Enviando feedback para o Redator.")
                  # Prepara a entrada para o Redator corrigir com base no feedback
                  # Inclua as prefer√™ncias do usu√°rio na entrada para o redator corrigir
                  entrada_para_redator_correcao = f"""
                  T√≥pico Geral: {topico}
                  Forma de Abordagem Desejada: {forma_abordagem if forma_abordagem else 'N√£o especificada'}
                  Prop√≥sito do Conte√∫do: {proposito_conteudo if proposito_conteudo else 'N√£o especificado'}
                  Plano de Conte√∫do Completo:
                  {plano_de_post}
                  ---
                  POR FAVOR, REESCREVA/CORRIJA APENAS O CONTE√öDO DA SE√á√ÉO ESPEC√çFICA ABAIXO, BASEADO NO FEEDBACK.
                  N√£o inclua o t√≠tulo da se√ß√£o no in√≠cio da sua resposta.
                  Se√ß√£o a corrigir: {secao}
                  Rascunho Anterior Desta Se√ß√£o:
                  {rascunho_da_secao}
                  ---
                  Feedback do Revisor para Corre√ß√£o:
                  {feedback_revisor}
                  Por favor, incorpore as sugest√µes de corre√ß√£o do revisor no novo rascunho desta se√ß√£o, garantindo que a Forma de Abordagem e o Prop√≥sito sejam mantidos.
                  """
                  # Chama o Redator novamente com a solicita√ß√£o de corre√ß√£o
                  rascunho_da_secao = call_agent(redator_agent_obj, entrada_para_redator_correcao)
                  print("\n#### Rascunho Corrigido:")
                  display(to_markdown(rascunho_da_secao))
                  print("-------------------------------")

          # Fim do ciclo de revis√£o para a se√ß√£o atual

          if not revisao_finalizada:
              print(f"‚ö†Ô∏è Aviso: A Se√ß√£o '{secao}' n√£o foi aprovada ap√≥s {MAX_TENTATIVAS_REVISAO} tentativas. Usando a √∫ltima vers√£o gerada.")

          # Adiciona a vers√£o final da se√ß√£o (aprovada ou a √∫ltima tentativa) √† lista de rascunhos individuais
          # Adiciona tamb√©m o t√≠tulo da se√ß√£o para melhor visualiza√ß√£o no final
          rascunhos_individuais_secoes.append(f"## {secao}\n\n{rascunho_da_secao}")

          # Adiciona tamb√©m √†s partes do rascunho completo (mantendo a funcionalidade original)
          rascunho_do_post_partes.append(f"## {secao}\n\n{rascunho_da_secao}")


      # Junta todas as partes das se√ß√µes revisadas para formar o rascunho completo
      rascunho_do_post = "\n\n".join(rascunho_do_post_partes)

      print("\n--- Gera√ß√£o e Revis√£o por Se√ß√£o Conclu√≠das ---")
      print("\n## üéâ Rascunho Completo Gerado (Ap√≥s Revis√£o por Se√ß√£o) üéâ")
      # Exibe o rascunho completo final formatado
      display(to_markdown(rascunho_do_post))
      print("-------------------------------")


  ## ‚úÖ Processo de Planejamento e Gera√ß√£o Finalizado ‚úÖ

  print("\nO sistema concluiu o processo de planejamento e gera√ß√£o de conte√∫do.")

!pwd

# Commented out IPython magic to ensure Python compatibility.
# %cd /content

!git clone https://github.com/Thomas-Yano/Alura_projeto
!git config --global user.name "Thomas-Yano"
!git config --global user.email "yanoyuiti2019@gmail.com"
!git add .
!git commit -m "Primeiro commit: Adicionando o notebook do projeto"
!git remote add origin <URL_DO_SEU_REPOSITORIO_GITHUB>
!git push -u origin main